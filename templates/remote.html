{% extends "layout.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Remote Command Execution</h2>
</div>

<div class="card shadow-sm">
    <div class="card-body p-2">

        <!-- Command Form -->
        <form method="POST" action="{{ url_for('send_command') }}" class="mb-4">
            <div class="mb-3">
                <label for="device_id" class="form-label">Device ID</label>
                <select name="device_id" class="form-control" required>
                    <option value="" disabled selected>Select a device</option>
                    {% for device_id in device_ids %}
                    <option value="{{ device_id }}">{{ device_id }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="command" class="form-label">Command</label>
                <textarea name="command" class="form-control" rows="5" required></textarea>
            </div>

            <button type="submit" class="btn btn-primary">Send Command</button>
        </form>

        <!-- Latest Output Section -->
        <h4 class="mt-4">Latest Output</h4>
        {% if output %}
            {% for device, data in output.items() %}
            <div class="card mb-3">
                <div class="card-header">
                    <strong>{{ device }}:</strong> {{ data.timestamp }} (User: {{ data.user }})<br>
                    <strong>Command:</strong> {{data.command}}
                </div>
                <div class="card-body">
                    <pre style="white-space: pre-wrap;">{{ data.output }}</pre>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>No outputs yet.</p>
        {% endif %}

    </div>
</div>

<!-- Hide preloader on page load (optional, if used in layout) -->
<script>
    window.addEventListener('load', function () {
        const loader = document.getElementById('preloader-overlay');
        if (loader) {
            loader.classList.add('fade-out');
            setTimeout(() => loader.style.display = 'none', 500);
        }
    });
</script>
{% endblock %}
